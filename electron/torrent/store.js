import fs from"fs";import{PATHS,DEFAULT_DOWNLOAD_DIR,DEFAULTS}from"./constants.js";const debounce=(t,s)=>{let e;return(...r)=>{clearTimeout(e),e=setTimeout(()=>t(...r),s)}};class Store{constructor(){this.config=this._load(PATHS.CONFIG,{downloadPath:DEFAULT_DOWNLOAD_DIR,maxConns:DEFAULTS.maxConns}),this.state=this._load(PATHS.STATE,[]),this.rssHistory=this._load(PATHS.RSS_HISTORY,[]),this.saveState=debounce(t=>this._write(PATHS.STATE,t),DEFAULTS.saveDebounce)}getConfig(){return this.config}getState(){return this.state}getRssHistory(){return this.rssHistory}saveConfig(t){this.config={...this.config,...t},this._write(PATHS.CONFIG,this.config)}saveRssHistory(t){this.rssHistory=t,this._write(PATHS.RSS_HISTORY,t)}_load(t,s){try{if(fs.existsSync(t))return JSON.parse(fs.readFileSync(t,"utf-8"))}catch(t){}return s}_write(t,s){try{fs.writeFileSync(t,JSON.stringify(s,null,2))}catch(t){console.error("[Store] Write error:",t.message)}}}export const store=new Store;