import Parser from"rss-parser";import{store}from"./store.js";import{DEFAULTS}from"./constants.js";export class RssManager{constructor(s){this.parser=new Parser,this.onAdd=s,this.interval=null}start(s){this.stop(),s&&s.length&&(this._check(s),this.interval=setInterval(()=>this._check(s),DEFAULTS.rssUpdateInterval))}stop(){this.interval&&clearInterval(this.interval)}async _check(s){const t=store.getRssHistory();let r=!1;for(const e of s)try{(await this.parser.parseURL(e)).items.forEach(s=>{const e=s.link||s.enclosure?.url;e&&!t.includes(e)&&(this.onAdd(e),t.push(e),r=!0)})}catch(s){}r&&store.saveRssHistory(t.slice(-1e3))}}