import{BrowserWindow,shell,app}from"electron";import path from"path";import fs from"fs";import{fileURLToPath}from"url";const __dirname=path.dirname(fileURLToPath(import.meta.url));class WindowStateManager{constructor(t,e){this.path=path.join(app.getPath("userData"),t),this.defaults=e,this.state=this._load(),this._save=this._debounce(this._write.bind(this),300)}_load(){try{if(fs.existsSync(this.path))return JSON.parse(fs.readFileSync(this.path,"utf-8"))}catch(t){console.error("Failed to load window state:",t)}return this.defaults}_write(){try{fs.writeFileSync(this.path,JSON.stringify(this.state))}catch(t){console.error("Failed to save window state:",t)}}_debounce(t,e){let o;return(...n)=>{clearTimeout(o),o=setTimeout(()=>t(...n),e)}}getBounds(){return this.state}save(t){this.state=t,this._save()}}const windowStateManager=new WindowStateManager("window-state.json",{width:900,height:600});export function createMainWindow(){const t=path.join(__dirname,"../../resources/icons/icon.png"),e=windowStateManager.getBounds(),o=new BrowserWindow({...e,minWidth:600,minHeight:400,icon:t,title:"SimpleTorrent",backgroundColor:"#050505",frame:!1,titleBarStyle:"hidden",webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:path.join(__dirname,"preload.js")}});o.setMenuBarVisibility(!1);return"development"===process.env.NODE_ENV?(o.loadURL("http://localhost:5173"),o.webContents.openDevTools({mode:"detach"})):o.loadFile(path.join(__dirname,"../dist/index.html")),o.webContents.setWindowOpenHandler(({url:t})=>(shell.openExternal(t),{action:"deny"})),o.on("move",()=>{windowStateManager.save(o.getBounds())}),o.on("resize",()=>{windowStateManager.save(o.getBounds())}),o}