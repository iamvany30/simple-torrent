import{ipcMain}from"electron";import{torrentEngine}from"./torrent/index.js";import{setupTorrentIPC}from"./ipcs/torrent.js";import{setupSystemIPC}from"./ipcs/system.js";import{setupWindowIPC}from"./ipcs/window.js";import{startUpdaterLoop}from"./ipcs/updater.js";export function setupIPC(t){const e=()=>{if(t&&!t.isDestroyed()){const e=torrentEngine.getSummary();console.log(`[IPC] Sending update to UI: ${e.torrents.length} torrents`),t.webContents.send("torrent:update",e)}};ipcMain.on("ui:ready",()=>{console.log("[IPC] UI reported ready, forcing update..."),e()}),ipcMain.on("magnet:open",(e,o)=>{t&&!t.isDestroyed()&&(t.webContents.send("magnet:received",o),t.isMinimized()&&t.restore(),t.show())}),setupTorrentIPC(t,e),setupSystemIPC(t,e),setupWindowIPC(t),startUpdaterLoop(t)}